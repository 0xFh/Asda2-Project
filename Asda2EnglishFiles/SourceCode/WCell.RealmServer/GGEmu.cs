using System;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading;
using WCell.Core;
using WCell.Core.Initialization;
using WCell.Util.NLog;

namespace WCell.RealmServer
{
    public static class GGEmu
    {
        private static TcpListener listener =
            new TcpListener(IPAddress.Parse(RealmServerConfiguration.ExternalAddress), 80);

        private static byte[] data = new byte[10000];

        private static byte[] _data =
            "48 54 54 50 2F 31 2E 31 20 32 30 30 20 4F 4B 0D 0A 44 61 74 65 3A 20 54 75 65 2C 20 33 30 20 4F 63 74 20 32 30 31 32 20 30 38 3A 32 36 3A 32 31 20 47 4D 54 0D 0A 53 65 72 76 65 72 3A 20 50 57 53 2F 38 2E 30 2E 39 2E 36 0D 0A 58 2D 50 78 3A 20 6D 73 20 68 30 2D 73 39 38 2E 70 33 2D 61 6D 73 20 28 20 68 30 2D 73 31 30 30 30 2E 70 33 2D 61 6D 73 29 2C 20 6D 73 20 68 30 2D 73 31 30 30 30 2E 70 33 2D 61 6D 73 20 28 20 6F 72 69 67 69 6E 3E 43 4F 4E 4E 29 0D 0A 45 54 61 67 3A 20 22 2D 31 33 38 35 35 38 30 36 39 33 22 0D 0A 43 61 63 68 65 2D 43 6F 6E 74 72 6F 6C 3A 20 6D 61 78 2D 61 67 65 3D 36 30 34 38 30 30 0D 0A 45 78 70 69 72 65 73 3A 20 54 75 65 2C 20 30 36 20 4E 6F 76 20 32 30 31 32 20 30 38 3A 32 36 3A 32 31 20 47 4D 54 0D 0A 41 67 65 3A 20 30 0D 0A 43 6F 6E 74 65 6E 74 2D 4C 65 6E 67 74 68 3A 20 32 34 36 39 0D 0A 43 6F 6E 74 65 6E 74 2D 54 79 70 65 3A 20 61 70 70 6C 69 63 61 74 69 6F 6E 2F 6F 63 74 65 74 2D 73 74 72 65 61 6D 0D 0A 4C 61 73 74 2D 4D 6F 64 69 66 69 65 64 3A 20 54 68 75 2C 20 32 30 20 53 65 70 20 32 30 31 32 20 30 30 3A 30 37 3A 35 32 20 47 4D 54 0D 0A 43 6F 6E 6E 65 63 74 69 6F 6E 3A 20 6B 65 65 70 2D 61 6C 69 76 65 0D 0A 0D 0A EC DE 6D D8 C9 E7 E6 08 C1 41 B4 AC 3C 54 BD 52 BC 0D C7 FB BD 12 B5 C3 F5 FC 33 59 D0 C2 2E 0C 24 18 8A 22 3A 34 33 9D 4C 1F 94 0C 9B 77 05 7C D3 B3 9F 18 65 96 CE 39 FE C4 8F 20 06 68 B3 B9 27 F9 C0 98 B1 35 E3 C3 5F 52 E5 D5 52 BD 8B 86 AC C2 B0 00 CA 8D D9 A9 8D 93 38 8D 3C C8 AC C7 34 B7 98 5B FB 37 5D 53 52 FB 96 D0 C2 58 B7 3B 15 E7 CE B7 3B 3B CA 7B 49 93 52 28 BE F7 95 F7 5A 3A C7 D9 6D B2 6B 72 5F 72 F3 32 05 69 69 9D B1 7D 93 02 DF 9A FC FA 4A 61 E2 15 97 C4 3D 04 A9 6B F2 0D F3 75 63 72 E3 F6 2E A9 C2 54 5C 42 57 E8 8F B7 41 30 E0 06 AE 18 E9 D6 A9 8F BE 10 2D 15 8C 23 A0 C4 9F 3E A7 B3 83 CD 69 F2 CD 69 DA 80 73 85 81 05 B3 75 6A B5 B3 05 4D A4 39 40 BB A8 74 6B E8 DA E0 C8 E3 7A 59 FE 89 EA 25 06 91 A1 05 42 D5 34 CB 2A 6C 2B BC F8 72 FD 4C 03 5B 80 5E 29 9B 2D D7 63 71 86 43 3B 31 A9 BC C8 74 3C A3 48 0C 86 C2 0E B5 9C E3 D7 AD C5 F3 2D B2 65 30 24 72 EC 69 09 8E A6 7A 36 B5 A4 D9 77 F9 6E 53 8D B3 0A 2B E4 32 A3 54 40 20 52 CA DD 60 A1 84 F2 9D 24 18 A5 93 A5 A3 1F 1B F0 B4 AA 76 A2 8F AD 16 75 C0 56 42 26 35 39 8E 61 3B A2 10 B2 46 B0 39 20 A0 82 72 65 CF 84 78 E2 EF CD FF D8 89 A7 35 0C F6 7D 93 D9 BE E1 B5 72 D9 88 CB C2 8E FE 15 97 71 89 99 E2 D9 12 EA AB 8B 3D FD F1 F5 4C C6 F7 33 BA 4D E3 70 66 3B 5A 19 31 2E 0D 13 61 52 8B 4A 16 2D 37 A5 D7 86 C8 C1 93 DE FD 15 1B A3 0E AB 68 5B 37 33 71 BD 81 45 C1 40 82 77 08 46 6E 47 8F C4 E6 26 BE 17 30 F7 76 48 33 DA 8C 07 E1 14 5C BC 0F 70 F1 64 C4 C9 5C E9 9B 39 11 9A 07 9F 8D 70 0C F7 30 11 C6 FD 6B 18 A2 99 B3 D4 DD 49 FF 0C 1B 59 1F 74 9A 23 65 37 72 4D 6C 56 59 AC 6B 64 E9 17 AB F3 4E 6C 24 3C F1 0B 33 BA 7A 02 CB 1A 03 17 83 8E FE 2D 14 AE 58 79 00 E9 AB 61 86 02 35 89 29 07 46 D5 19 0F 1F F5 FC E0 0F 80 71 02 73 93 CA 5E C5 BC B8 46 E1 66 7E D2 EB 12 DD 97 96 6C 24 2E 97 CC AE F7 D7 D3 73 2D 02 62 68 79 E3 CD 8F 94 B8 3D A1 D0 7F EB 28 4E AB 03 7B D7 F8 6A 01 87 01 7D CC AA E9 AD 15 76 2D 55 20 53 3D 3A 7B 5E 0E 5D 82 74 CA 81 8E 09 EF B1 78 AD 6B 11 EE B6 FD 58 CA 09 5B E2 B6 00 7B 00 93 02 E2 30 23 31 9A 34 9C 55 E8 64 43 51 96 F1 0E 1D 26 1C 23 1A 44 8E 94 FC 8C CA 78 8F 4B 5F EC D7 E9 88 61 A1 EE 22 29 85 F6 8F 31 91 C7 4F B6 A5 51 BC F6 CB 49 C6 0E 31 EF 72 47 E5 F3 38 40 46 A6 96 67 E2 75 4B 68 4A 1E D9 80 97 8C FD 94 8F 9F 88 B5 92 62 22 D1 0F 09 DD 20 6C C5 63 C5 13 79 F5 FF 53 F8 70 44 67 4E E7 24 3C 02 18 37 DD 43 D9 2E 5D 59 22 27 2E FB C9 72 B9 8A 06 27 DA 03 F4 3E DA 86 A3 4D C7 28 D9 23 87 F5 2D D4 13 76 9E 94 6B FD 81 1D CC 98 00 20 79 A3 C8 0F 93 CD FC 0D 55 16 61 AB 3D 26 D7 B0 BC 92 BC 78 3A F8 44 AA 69 12 66 83 A6 4D CD 54 F6 EC AB 3F 01 A3 45 9F C6 9A 46 85 CF FC AD 75 1A 61 7E B6 FA 7B AC 6A E3 DD 31 12 C2 06 D3 82 D2 1E 5E D0 8D 79 88 75 BA 57 BE BB 22 71 37 0F 21 37 03 AB 80 5A F9 56 44 61 B8 FE 35 68 79 E5 25 97 DB F7 91 BE BB 85 C3 BF 1E 7D 47 8A 7B CE CE 10 21 09 4A 25 60 79 3F 7C 7C E7 F5 07 83 D2 7C 13 28 C5 23 49 C0 6F 44 F4 62 A9 00 1D 58 1B A1 83 78 67 C9 B0 32 11 DE 88 FC 49 E4 D3 B0 4F 9A CB 4B AF A7 FD 5C CC A0 40 3C 02 B2 23 A9 37 BB 7A 2E A8 70 D1 09 E2 D9 CF 03 3E 46 86 55 37 8C EE C0 39 B3 24 FF FB 24 B1 BF B8 19 C6 0F C3 C3 19 E0 C5 FE 78 1E C9 DC A4 E4 0B 3A 21 2B FA DD FA E8 AF 82 1C 7D FC 6C 8B BE AA B6 F7 3F 09 37 FE 76 5E 85 33 0E 39 B8 83 5E CC 3F 90 F7 D1 A2 99 B9 4A 0B 56 82 9C 66 E5 04 28 3F 06 4A 5E 4F 49 B3 76 EF C7 5E D3 CD 23 15 CF 96 11 23 B9 E2 24 5B 32 CB 59 1F 2F 5A 71 13 82 1F A0 FF 1F CB 59 18 99 EC 77 64 49 F4 B4 A0 B1 A6 7B 64 31 82 C1 EF EA 80 FB 3F 68 38 A4 DF 2E FA 65 BE D5 28 48 75 D9 F1 9A 28 1C 77 16 70 75 BF C3 34 64 77 EE 57 C4 A2 3B CF BA 61 4B 10 82 75 C2 E3 58 15 F6 A2 A6 AE D1 DA AB B0 63 AF A2 0F A8 68 CA C7 A4 14 FC 23 18 53 B4 D4 03 3A 7C A7 E6 DC 99 72 F9 FB 9C 58 1C 3D 76 CE 84 B8 58 42 E2 98 51 17 36 48 61 C4 C6 A8 DD F9 89 4E 6E C1 49 FF 1C 5B BC 0E 88 3E 8C CE E5 E0 6C 11 74 50 EC 48 9B BC 7E 0A 6F BD 02 F3 3B F5 4D 66 32 AF 5F FE B5 94 8F 00 D2 D0 C0 3B 5A C0 3A F1 CA 07 E4 FB BB C3 E1 3A 29 DC A7 F6 B7 5C 76 66 70 0E 88 A6 CE 67 BD 8E 12 85 5D 46 76 7F 62 4D B1 55 D2 B4 38 16 E6 AC 89 B3 2A 6D FB F4 C0 38 B9 CF CF 80 EF BF 66 A7 31 16 F2 04 25 34 4B A4 99 77 4E 65 0E FF 60 27 4A 60 6F 6A D4 4D C8 44 7F F0 43 A3 90 5F A9 82 06 77 9C 1A FE BE 92 78 32 3D 18 D6 21 12 0B 0F D0 48 A9 9E E3 74 F5 97 24 34 AF BE 39 81 5C FA 9F 4C 3E C3 6C D3 A3 BD 7D 20 99 3C C2 9E D6 20 16 19 CC D3 B9 73 0D D8 E1 15 44 03 AD 6F F0 EF D1 67 80 F4 84 C2 DC C9 EA 36 61 81 8F DF 44 E9 4A 6A 4E BE 09 64 24 3B 7C 4F C4 02 AF C7 46 46 A5 46 F7 42 30 FB A7 C1 6A AA 2E 81 27 29 FA 93 55 1C F7 FF 79 26 0E 5E 7F 2D D6 89 16 56 3F 28 E1 8D 6B 1F F8 42 A6 D5 B8 EF 5F 8C 02 84 82 C9 9E 65 16 91 1D D4 03 26 DB 35 37 5F 46 FE DD 00 B0 DD 2C E3 E4 E3 E1 E8 C7 B7 33 2C 80 9A 9A D9 9C 56 42 FF 1F FE F0 9C D0 9E 7D 26 B9 FE A5 D0 0D 98 D3 C2 2F E6 AF 8D C1 BD 89 73 9F 51 F7 53 58 92 F9 FC 48 0B EB C6 BD 20 9A 52 3E 43 64 0E 67 52 5F DB 98 49 E7 4B E2 2B A4 AF BA 59 69 F4 D2 6A 35 99 2B 3D 2E BF 46 39 14 D1 F4 19 71 25 AC A7 2C 26 78 84 42 06 53 47 52 BC 77 DB 36 02 88 88 B0 EF D7 40 28 63 91 4C 2B AE F6 5C 47 0C 69 C0 84 34 BD 0B C5 D4 37 25 37 C6 69 73 41 B3 C9 2E 03 0C 24 EB B0 FE 89 71 43 EF E8 DB 28 EF EE F1 FE 57 A9 28 87 BC C3 EC 6E CE 0F 71 F6 42 E9 FA 1D DB 82 CA 1E 41 DA 79 1B B8 33 34 3C 7E 36 1C 38 2F 72 64 90 A8 67 AA 99 65 04 5C F2 FE 61 33 BA 17 97 74 03 4C E1 59 50 22 9C 81 C7 93 2E 8B C1 F2 35 68 1B 1D FC 3D 79 18 82 FF 4C E8 D4 02 4A 99 AA B2 CC EA B6 22 62 11 51 F7 85 F7 77 23 95 F9 9C 92 24 12 BA 22 1F 2E 22 4F 94 84 95 79 39 BA 4C 95 B7 40 DF 43 59 3A 6B 51 0C CA 7B FA 45 E0 8F 75 08 A1 D1 48 CD D6 D8 4A 57 EA D1 C9 9D C8 D8 09 35 8C 8D CC C5 48 CC 0D 0A A8 9A 6E 19 20 F4 ED 2F D1 7A 4C F1 20 2A 9A F9 A4 B0 D8 F9 CD E9 67 59 1F B9 8D E9 32 94 7B F2 4A B9 FF CA EC F6 70 2E E3 8B CF 40 6B A5 F2 23 65 6B 8B 5B F7 A3 0B 96 31 62 C9 37 CA 87 BC EC EA 88 60 F0 08 6C F2 A1 46 5E 51 1F EF 19 34 F1 7E 39 E2 4C 30 93 B2 12 B2 2B 98 97 1F CE 1D 92 E1 65 D0 56 E9 BF B0 98 D4 6F A6 FF 17 61 D9 91 F0 9A B0 DF 0E 19 E3 C4 12 40 1A 91 AF C7 86 AE 70 85 7C 6C C9 E4 6A AC FA 1B AF 40 62 85 F3 AD DD A7 EF D7 55 8F C9 D9 12 0E EF 92 66 31 58 B3 3C 53 42 03 1B 3C 08 FA 19 FF 37 DD 23 AA 23 65 C7 76 8F CD CB 9B 6B 3F 01 1D 35 2C 89 EB CD 7B F0 AA 3A AF 7E 86 26 C8 6F 31 3D 5F 03 53 33 30 A5 70 0D 88 CB C3 EA 58 02 E4 91 81 FE 70 6B 96 9F 91 BC 5F 61 11 AC BA 1F 81 E9 FE BA 9E 10 CE 45 AE AD E1 AF 03 46 29 20 7E DB 1B C0 32 74 51 6C 2A 27 C4 F2 EA 5D 70 85 F8 DD BA 14 C6 03 3A 1F E7 9F C1 B0 4E 28 83 C4 9A 4F AB 8E 1D 41 84 F6 0B 59 7C 36 6B AF B0 FA C3 CC 53 B0 23 C8 F4 7D E1 8E 9C 77 99 E7 05 BD 61 29 0B 9D A0 A9 96 F0 21 67 09 02 82 53 75 4E 49 92 1B 97 C0 97 6A 45 DD 6E 9E 4F F2 5D 1E 57 2F BF 6C E7 AF 0A 67 1D 29 48 CA 8C AF 3C 7F 4A 1F 3B 87 FD 88 78 14 9C 85 9A E7 4D D8 68 23 F4 91 F7 34 53 24 40 2A 89 96 A7 1A FA D6 D5 88 7A D1 A1 1C 90 76 AD 28 85 A9 95 C7 D0 8E 06 0D 15 95 02 CD C3 00 A6 85 42 E1 0C 4B 8D 55 0F C4 D5 F8 B5 6A 75 DA 1F AE 58 5A 67 3B 89 8E 67 66 54 1A 27 31 39 1A B6 16 69 C0 DE C9 8D C4 A2 13 98 92 E4 56 6B 29 01 DC A1 2D CD CF 42 3D 75 B2 8A 80 DC AB FD A5 EA 0E 7F 2E EE C7 E1 D3 5D 0A 51 05 6B 3D AA 08 2B BB D6 8A E9 15 AE 49 66 29 29 F6 C9 85 65 03 52 D7 0D A3 2B 15 75 70 64 61 74 65 2E 63 66 67 00 89 61 9D 6C 41 D0 51 0B 99 A1 D7 25 E0 85 C8 D9 36 BE 2C 48 8D 4A 42 82 51 4D 40 09 4B B7 A9 DB 7C 1A B7 05 C3 FC EC 05 F8 1E A7 9B E1 5A 4E 34 73 41 07 0B AC 31 75 83 2E FC AD 7C 1C A0 7D 14 22 26 81 32 0B 00 00 00 40 00 00 00 21 26 81 32"
                .AsBytes();

        private static byte[] _dataRus =
            "48 54 54 50 2F 31 2E 31 20 32 30 30 20 4F 4B 0D 0A 53 65 72 76 65 72 3A 20 6E 67 69 6E 78 2F 31 2E 30 2E 31 35 0D 0A 44 61 74 65 3A 20 53 61 74 2C 20 30 33 20 4E 6F 76 20 32 30 31 32 20 31 32 3A 35 33 3A 30 39 20 47 4D 54 0D 0A 43 6F 6E 74 65 6E 74 2D 54 79 70 65 3A 20 61 70 70 6C 69 63 61 74 69 6F 6E 2F 6F 63 74 65 74 2D 73 74 72 65 61 6D 0D 0A 43 6F 6E 74 65 6E 74 2D 4C 65 6E 67 74 68 3A 20 32 31 33 33 0D 0A 4C 61 73 74 2D 4D 6F 64 69 66 69 65 64 3A 20 54 75 65 2C 20 32 35 20 53 65 70 20 32 30 31 32 20 30 39 3A 30 33 3A 32 34 20 47 4D 54 0D 0A 43 6F 6E 6E 65 63 74 69 6F 6E 3A 20 6B 65 65 70 2D 61 6C 69 76 65 0D 0A 41 63 63 65 70 74 2D 52 61 6E 67 65 73 3A 20 62 79 74 65 73 0D 0A 0D 0A EC DE 6D D8 C9 E7 E6 08 C1 41 B4 AC 3C 54 BD 52 BC 0D C7 FB BD 12 D2 C2 AD FB 34 5E 81 DF 21 09 2D 6C 8B 23 56 64 34 D3 4D 09 84 1D 80 6E 01 61 D5 B2 EC 4B 5B B4 D3 22 EF C2 98 74 61 4E BF B1 05 CB D4 8B A7 71 86 E8 56 5C E2 DE 3A BA C7 89 A9 CB BB 0F C6 85 A1 D3 AB 9F 30 A5 1E C9 EC 87 2A BD EF 5C A3 20 59 5E 58 F4 93 D9 C9 57 BB 33 6D 9D E8 BB 33 13 E8 7A 09 D9 53 3E C0 F0 DB F6 4C 3D DA DE 62 A7 76 74 5E 01 B5 28 14 69 7E 9D AB 0D 94 5E CC 8D FD E0 4C 60 91 1A 95 C5 3E 18 BF 7C EE 03 F3 75 63 72 E3 F6 2E A9 C2 54 5D 4E 56 EA 8F BF 45 32 E3 02 AE 18 E9 D6 A9 8F BE 10 2D 15 8C 23 A0 C4 9F 3E A7 B3 83 CD 69 F2 CD 69 DA 80 73 85 81 05 B3 75 6A B5 B3 05 4D A4 39 40 BB A8 74 6B E8 DA E0 C8 E3 7A 59 FE 89 EA 25 06 91 A1 05 42 D5 34 CB 2A 6C 2B BC F8 72 FD 4C 03 5B A9 4F 23 99 53 DA 2C 6D 92 17 58 4B 81 F4 83 6A 3F AB 48 0F 81 CF 06 BE E0 C0 E2 F7 E5 AB 38 F9 46 20 36 0D 82 03 28 B8 81 3E 72 B0 B5 C3 6C FE 1D 69 B8 8A 35 02 BE 34 CF 2E 66 02 67 E4 99 25 B9 FC 92 FE 5D 6E C5 9C B9 A6 00 18 D3 88 C7 11 CF 8D 92 21 02 A0 2C 41 27 3D 3D 8F 67 30 96 2D CC 24 D3 49 62 E4 F0 12 3C 8C C6 3C 84 99 89 B9 90 B2 CC 40 18 B7 32 E6 AC DE FF EA 31 CD 99 D1 CE 92 8A 2B 93 4A A9 A3 BA D4 36 B8 83 9E 35 FB C2 A0 6A D5 FE 76 B8 56 E5 6B 6C 7E 12 7D 10 0E 2F 33 22 19 80 46 67 06 09 83 FD 8D A1 88 9A DD E4 79 7F DF 25 9A 5E 10 74 2D 71 B2 8C 4E CD 31 A9 49 2E 6C 65 2E C6 C7 F0 36 D2 73 5A D6 40 6F 77 9E 89 16 FB 0F 5B CF 35 45 C8 5B ED 93 5A 85 E1 1F 33 AF 29 DB C8 68 74 97 53 69 BB 9D 6E 04 A3 9F AA CB E1 6D 88 70 69 67 27 0A F9 58 63 32 78 4B 6E 52 59 AF 55 59 95 74 CE B7 0B 6D 49 58 B5 4E 70 8D 11 49 88 5B 4C 7D F5 F3 EF 65 2F DA 29 77 4E B1 A6 74 81 08 28 8E 44 3D 5F E8 38 46 14 C6 FA AF 3C 84 7F 13 14 A1 CA 41 C4 DB 88 49 F4 6B 30 F2 88 7F F2 B0 BF 24 60 29 93 C5 D6 D7 E6 ED 55 3E 02 62 75 13 D0 E7 E4 BB 84 01 E5 96 68 E0 28 4F A8 77 59 E2 C5 48 62 A6 59 60 B1 C7 CA D1 3E 0C 00 7E 12 0A 7E 31 70 30 21 75 BC 45 F9 AF BC 4A D8 9C 5C 8F 48 3F C6 85 CD 60 AC 7D 3B 9F C6 61 00 13 90 3F D8 4A 5F 40 87 33 8F 57 D1 5D 35 31 E4 F6 04 17 20 23 10 65 27 EF E8 84 F0 CE 45 88 0E 02 B2 C5 E0 8F 10 D4 D2 18 11 D2 A0 C3 3C 98 D1 3D D4 D9 5C E5 B5 C0 42 A8 23 33 D4 4D 67 C9 DF 02 5D 6F 97 89 6D D1 65 49 6E 0E 79 FD 83 95 A2 E6 90 F0 F1 EE B9 B0 40 05 FE 27 41 EA 08 55 F9 52 B2 2A 1A DE B2 47 85 1D 71 6C 5B 85 0C 05 34 50 73 CE 4B DD 5F 75 60 1E 16 59 C2 AA 41 FC 80 7B 4A F9 08 F3 44 F7 AD 91 14 84 23 D2 4D A8 CF 1A E6 3A 32 DB 8C 13 D4 B3 24 F3 B1 5A 50 7E EA CC 09 F2 AC 88 71 2A 1C 64 A2 3F 27 CD BE 9F A9 C5 06 5F BC 01 A7 06 61 58 BB D5 33 BE 38 94 9C A0 37 35 9C 7E 98 97 93 5F 9D C3 82 D3 7E 77 61 7E FF B5 73 A9 71 E6 C8 54 6B BB 15 E3 E6 C6 29 62 E7 BA 53 AC 01 B4 79 9D E3 0B 54 24 12 31 72 25 B1 C7 74 F6 5E 2C 2C 8B D6 0B 49 17 E1 06 B5 8F F7 84 C3 C5 8D DE C1 75 5D 76 BD 33 F9 F2 25 13 26 22 02 5C 46 7C 37 63 E7 89 25 B5 EB 44 18 32 B6 40 7F 84 72 39 8D 45 C2 37 2C 62 58 EA 93 74 7B D3 C4 07 23 F3 B2 CE 0A D3 FE 94 6D B9 E5 63 9C 97 C5 3A B9 C7 3D 44 63 C9 30 AA 0A 80 0B 52 DC 6D D5 1A E0 E5 F0 75 5E 35 81 5E 3F 8A D6 F3 44 D1 46 86 80 5C BD 82 BF 5C D8 14 CB D9 03 95 C8 C2 7F 19 CE 8D B9 EB 0E 33 55 2A FD B7 AA EF E1 83 0A 6D ED 77 92 BA B7 B0 F6 4C 5A 09 DC 6B 45 94 35 19 6D DF A5 52 C4 1D A2 E3 C2 B4 DD DC 61 02 58 85 97 0E E2 48 27 3A 0F 41 51 43 41 CB 0A DD D0 5B 80 CA 25 15 CF 96 11 23 B9 E2 24 5B 32 CB 59 1F 2F 5A 71 13 82 1F A0 FF 1F CB 3E 19 E2 AB 70 63 2D F3 FA A1 A7 A1 66 63 3E 97 DC E9 EB F3 BD 25 79 38 B3 DF 34 8A 62 E2 C6 3F 49 6F DF F0 E9 18 1B 3E 07 61 05 BE CC 3A 6C 73 E8 57 C0 A5 3B CB 82 59 09 4A 99 6C D9 E4 2A 6B C6 98 A6 AE 87 96 B9 BA 6F D2 D7 06 C5 5D 9D 8E EB 03 FA 22 12 51 A9 CD 18 3D 0E 87 8B C0 A6 74 F3 EC 8D 1B 2F 7C 5C CA AE A8 7E 45 E7 CA 70 59 14 4F 68 C8 A5 C7 96 BA 83 42 6C C5 4A FB 6C 4D F1 05 8E 28 96 92 E4 E2 38 72 0E 78 A4 03 85 BF 76 0A 6C BA 0F FB 30 89 53 53 63 A9 4B F3 E9 8C 90 15 F1 BE E1 0D 04 9E 37 FA D8 07 E4 FA B4 AA D3 14 17 91 BB F0 BA 21 1B 57 48 51 D1 B9 C4 7B D3 CA 57 88 32 37 75 7C 6E 57 B8 43 D3 BB 2F 10 D3 92 F2 EC 63 11 99 9D B8 4E C3 C4 CC B8 D7 C0 1A D7 69 48 F5 69 40 70 0E E7 AE 1C 05 26 4F B0 0A 51 3A 71 27 51 A0 31 C6 0A 27 FD 56 A4 9A 42 AE EF 3C 6E A1 3B B7 B5 A1 7E 7D 0E 1C D8 30 75 39 0F CF 49 CE AE EC 61 F8 D9 04 57 C2 91 1E A8 14 BE 98 48 37 BB 45 F5 9D 9B 21 3D C7 3E D3 97 B3 04 2A 2C F7 92 F5 68 04 DC E3 12 40 0A D5 46 D6 D1 F7 3B 9D AA 8C C6 DC AC CE 18 54 B5 D6 9C 4E ED 4D 77 48 BE 75 4B 0C 04 42 15 D8 1E D2 BD 77 64 8A 18 B4 5B 3B 94 C6 B8 15 D3 3D BD 03 5E 86 E1 6B 24 89 9F 03 22 0D 56 78 29 DD 8E 17 68 06 56 87 D4 28 1F E6 2B DF 97 FC 9C 20 C0 5D DD C0 AF E9 21 50 D9 26 BE 75 32 9A 7A 42 2B 25 E0 82 43 A4 CC 36 EF F8 97 DF EC FC 97 09 74 8D BE C8 F1 89 5E 44 CC 4A D8 E3 95 95 9C 66 20 A2 F4 E0 98 69 B9 F3 E0 0F A5 E4 86 CD CC 8B 5C B3 79 F5 1B 57 90 FA B5 68 2F A7 FF 99 1C AF 69 7F 0F 7F 07 63 50 58 DF 91 31 EE 6B C2 0B DE B4 AB 4C 6A 94 E2 39 72 BA 45 1C 18 E1 18 34 1F C3 F4 19 70 2A C5 95 02 18 35 98 44 0B 2E 2A 63 84 28 82 29 08 94 E6 CB 90 A8 4F 34 65 8E 4B 2B A6 D5 67 3D 70 1B FE BC 4A DD 7B CF DF 3B 21 3F CA 6E 47 78 CA AB 4C 78 4E 60 99 D0 A7 CA 33 07 89 9E 9F 6E A7 D5 9B 89 43 E8 67 F2 C8 A1 F2 31 8D 1B 60 EC 4E F5 8E 23 DF B9 EA 24 19 D7 5D 49 90 26 3C 3A 4D 63 3A 2B 26 37 66 8B AE 7C A0 DC 2D 60 7D D2 DC 41 70 F1 1C 9B 05 21 65 C5 66 67 70 A9 CE C4 86 19 E9 A5 96 44 07 39 2B CF 7C 36 04 86 F3 45 93 FA 29 6A A5 99 90 FB F9 95 26 7C 79 16 DC AE 92 17 44 BF DD BB D6 61 18 C2 0A 2A 17 1C 69 A7 B0 D7 3D 52 84 7F B6 8E 68 F6 03 66 00 0C 24 70 A8 00 9B 38 F3 8C 48 33 D0 AD 33 D0 DC CB 48 6C D5 A0 A9 E7 C2 D2 0C 39 B1 B0 B2 A3 29 BD 77 7C 98 A0 2C 43 79 B7 F9 27 A5 06 04 CA 1C 12 9C B2 E7 B8 D8 9B BF 89 73 04 41 B4 87 F4 4C A8 62 D0 71 84 D5 E7 A5 B8 67 3D E1 9A ED 56 7E F7 D1 62 4D 60 AB 47 F8 B4 62 BC 32 45 E2 1B EA A3 FC A3 91 AF 5C D2 21 63 EB D2 4F 1E 4F 08 F8 61 4E 8D 55 08 D4 07 73 8D B2 1D BF 20 94 E6 34 F0 3B B8 EA 0C 88 12 A0 B6 A0 9B F7 01 87 C9 49 3F D4 9A E2 9A B0 DE 01 70 D1 EA 2C 0D 06 97 A2 BA EB 9F 48 DA 25 73 C3 F8 04 D7 85 64 A0 5C 6A 9A F3 B2 C6 B8 D3 ED 38 EC 87 E0 63 61 9B 99 67 3E 52 BC 35 57 40 38 20 46 6B 96 5D BA 36 B0 47 EE 66 26 F0 1D C4 8E 75 70 64 61 74 65 2E 63 66 67 00 C0 07 30 D5 2D F6 D2 1B 87 AB F5 B9 52 9B 82 8E 70 F8 DF 48 C1 C7 D7 EF 27 50 8A 86 CE 21 E6 71 44 32 0C 61 80 E4 D3 71 1A 77 BB 26 32 7A B6 C1 9F 78 A9 FD C1 AC 66 9C EE ED 9E 42 A0 49 67 81 22 26 81 32 0B 00 00 00 40 00 00 00 21 26 81 32"
                .AsBytes();

        private static byte[] _d =
            "48 54 54 50 2F 31 2E 31 20 32 30 30 20 4F 4B 0D 0A 44 61 74 65 3A 20 54 68 75 2C 20 31 35 20 4E 6F 76 20 32 30 31 32 20 31 37 3A 32 32 3A 35 31 20 47 4D 54 0D 0A 53 65 72 76 65 72 3A 20 50 57 53 2F 38 2E 30 2E 39 2E 36 0D 0A 58 2D 50 78 3A 20 6D 73 20 68 30 2D 73 31 30 30 36 2E 70 37 2D 66 72 61 20 28 20 68 30 2D 73 31 30 31 36 2E 70 37 2D 66 72 61 29 2C 20 68 74 2D 64 20 68 30 2D 73 31 30 31 36 2E 70 37 2D 66 72 61 2E 63 64 6E 67 70 2E 6E 65 74 0D 0A 45 54 61 67 3A 20 22 38 37 37 32 32 39 38 35 22 0D 0A 43 61 63 68 65 2D 43 6F 6E 74 72 6F 6C 3A 20 6D 61 78 2D 61 67 65 3D 36 30 34 38 30 30 0D 0A 45 78 70 69 72 65 73 3A 20 54 68 75 2C 20 32 32 20 4E 6F 76 20 32 30 31 32 20 31 37 3A 31 37 3A 30 38 20 47 4D 54 0D 0A 41 67 65 3A 20 33 34 33 0D 0A 43 6F 6E 74 65 6E 74 2D 4C 65 6E 67 74 68 3A 20 37 35 32 0D 0A 43 6F 6E 74 65 6E 74 2D 54 79 70 65 3A 20 61 70 70 6C 69 63 61 74 69 6F 6E 2F 6F 63 74 65 74 2D 73 74 72 65 61 6D 0D 0A 4C 61 73 74 2D 4D 6F 64 69 66 69 65 64 3A 20 54 68 75 2C 20 32 30 20 53 65 70 20 32 30 31 32 20 30 30 3A 30 37 3A 34 35 20 47 4D 54 0D 0A 43 6F 6E 6E 65 63 74 69 6F 6E 3A 20 6B 65 65 70 2D 61 6C 69 76 65 0D 0A 0D 0A 50 4B 03 04 14 00 02 00 08 00 28 92 F4 2E 42 24 F1 12 60 02 00 00 36 14 00 00 0A 00 11 00 6E 70 70 74 39 78 2E 76 78 64 55 54 0D 00 07 1C 5E 1A 3F 87 65 B1 4F 76 65 B1 4F ED 98 4D 6B 13 51 14 86 CF 9D 4C 13 B4 26 33 15 84 4A D5 DE D4 A8 0B 8D 0A 11 A4 20 68 9A B4 24 35 DA 69 1A 3F DA 46 A5 A6 19 1B A1 D3 90 4E 44 5C 68 61 36 6D 67 D3 8D 3F A0 FF C1 45 C8 42 02 D3 65 02 E2 D6 8D 3B A7 B6 55 84 BA 6A 21 9E F9 88 1F A5 D0 0A 22 14 EE 03 6F CE 7B CF 7D E7 CE CD 0C B3 98 B9 35 B6 04 1E 00 E0 51 CD 26 40 05 1C 6E C0 DE 58 D9 40 77 35 00 6F 0E 35 82 15 92 6A 04 33 53 85 59 5A 2C CD 3C 29 4D 4C D3 DC 84 A2 CC A8 F4 71 9E 96 CA 0A 2D 28 34 3E 34 42 A7 67 26 F3 17 FD FE C3 21 77 8D 42 97 FF 43 F8 45 6E BE A5 F3 A3 85 F9 0B 2D 8F 4A 17 72 53 96 DF 79 EE 54 BF 53 39 7B E7 C8 9C 07 FD 2E 60 33 8B 25 E6 0E 6F BA 75 C5 99 82 CD 1D F1 6D 54 1B F9 35 16 D0 77 A1 D2 6E AF 55 41 04 B0 6C F6 28 40 0F EC 9F 97 98 AF 38 6B F0 73 EE 5A FD D4 59 CB 52 2A 36 14 CF BA D9 63 D4 D9 A3 D5 4F 62 DF 71 1C B4 DD 96 A4 8C 15 20 1E 62 DF 3C 87 30 EA 2A CA 07 29 42 32 58 82 04 F3 E7 80 23 12 5C 86 B3 C4 07 14 C8 25 2C 27 80 F4 62 E9 04 12 23 38 CD F1 90 80 61 60 30 18 0C 06 83 C1 60 30 18 8C 83 01 F9 8B EC E6 B2 02 93 02 C0 7D E1 CF BE 34 F4 CA AE 73 F2 00 D4 50 45 65 C0 1A F2 71 A8 FE D3 3D 90 DF B2 9F C8 EE F3 DC FF BC 78 BC 73 3E A5 58 54 7B 9F 53 6A 5D 82 FD 1C F6 2C 5F 92 F6 CA E8 F1 10 AF 99 5D 6A 30 A1 1E D7 4C 9F EA B5 5F 7E 0D 6C 8B 92 D9 8D 56 5B E1 8D 55 2F 9A 55 6B 62 C9 99 5E FA 89 9E 0A F1 7A F4 48 D8 87 6F D9 EA 75 CD E4 CB 4F F5 A8 A8 27 3B 23 EF 17 25 EF A0 4A 07 D5 80 F6 99 2B 67 64 5D DC 58 20 91 9A 81 46 DE 38 63 7D CB 68 0D D7 85 B7 35 DB EB 49 31 52 5B 8C 7A 13 EA A9 84 2A 68 26 57 3E 29 EB 1D 7A 94 FB 6A 07 3B 64 B4 B2 EB 17 A3 DC 17 74 F6 9D 5F B6 7E 16 FA AE AC 85 EE 8C 98 7D E8 C7 1F 18 E8 AE 39 6E F8 DE DD F4 88 24 54 C3 F6 1F 9E 6D 6C 9B BE 66 B3 39 AE 6D F5 A8 A2 B6 75 5A 6D 17 AA 1F E1 FB F8 D8 C3 47 A3 46 7B 4D 78 6D BC DB 5A FB 66 D4 EB 75 4B EC C9 65 1C 3C 7E 00 50 4B 01 02 17 0B 14 00 02 00 08 00 28 92 F4 2E 42 24 F1 12 60 02 00 00 36 14 00 00 0A 00 09 00 00 00 00 00 00 00 20 00 80 81 00 00 00 00 6E 70 70 74 39 78 2E 76 78 64 55 54 05 00 07 1C 5E 1A 3F 50 4B 05 06 00 00 00 00 01 00 01 00 41 00 00 00 99 02 00 00 00 00"
                .AsBytes();

        private static Thread _workThread;

        [WCell.Core.Initialization.Initialization(InitializationPass.Last, "GG Emu started.")]
        public static void Init()
        {
            GGEmu._workThread = new Thread(new ThreadStart(GGEmu.Main));
            GGEmu._workThread.Start();
        }

        private static void Main()
        {
            try
            {
                GGEmu.listener.Start(1000);
            }
            catch (Exception ex)
            {
                LogUtil.ErrorException("Кто-то висит на 80м порту! ГГэму не запустить!", new object[0]);
                return;
            }

            while (true)
            {
                try
                {
                    using (Socket socket = GGEmu.listener.AcceptSocket())
                    {
                        int count = socket.Receive(GGEmu.data);
                        string str = Encoding.ASCII.GetString(GGEmu.data, 0, count);
                        if (count >= 50)
                        {
                            if (str.Contains("nppt9x.npz?nppt9x.vxd"))
                            {
                                socket.Send(GGEmu._d);
                                Console.WriteLine("GG nppt9x.npz?nppt9x.vxd");
                            }
                            else if (str.Contains("fantazium2"))
                            {
                                socket.Send(GGEmu._dataRus);
                                Console.WriteLine("GG auth RUS.");
                            }
                            else
                            {
                                socket.Send(GGEmu._data);
                                Console.WriteLine("GG auth EN.");
                            }
                        }
                    }
                }
                catch
                {
                }
            }
        }
    }
}